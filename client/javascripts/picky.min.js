Array.prototype.index=function(a){for(var b=0,j=this.length;b<j;b++)if(this[b]==a)return b;return null};Array.prototype.include=function(a){return this.index(a)!==null};Array.prototype.remove=function(a){this.splice(a,1);return this};Array.prototype.compare=function(a){return this.join("")==a.join("")};Array.prototype.each=function(a){for(var b=0,j=this.length;b<j;b++)a(b,this[b]);return this};Array.prototype.map=function(a){for(var b=0,j=this.length;b<j;b++)this[b]=a(b,this[b]);return this};var dictionary={common:{join:{de:"und",fr:"et",it:"e",en:"and",ch:"und"},"with":{de:"mit",fr:"avec",it:"con",en:"with",ch:"mit"},of:{de:"von",fr:"de",it:"di",en:"of",ch:"vo"},to:{de:"bis",fr:"\u00e0",it:"alla",en:"to",ch:"bis"}},results:{addination:{more:{de:"Weitere Resultate",fr:"Autres r\u00e9sultats",it:"Altri risultati",en:"More results",ch:"Mee Resultaat"}},header:{de:"Ergebnisse",fr:"R\u00e9sultats",it:"Risultati",en:"Results",ch:"Erg\u00e4bnis"}}},t=function(a){for(var b=PickyI18n.locale||
"en",j=a.split(".").concat(b),l=dictionary,h=0,k=j.length;h<k;h++){l=l[j[h]];if(l==undefined){l="Translation missing: "+a+"."+b;break}}return l};function Allocation(a,b,j,l,h,k){var o=this;this.type=a;this.weight=b;this.count=j;this.combination=l;this.ids=h||[];this.entries=this.rendered=k||[];this.isType=function(r){return r==o.type}}function Allocations(a){this.allocations=[];for(var b=0,j=a.length;b<j;b++){var l=a[b];this.allocations.push(new Allocation(l[0],l[1],l[2],l[3],l[4],l[5]))}this.length=this.allocations.length;this.remove=function(h){this.allocations.splice(h,1)};this.each=function(h){this.allocations.each(h)}}
function PickyData(a){var b=a.total,j=a.duration,l=a.offset,h=new Allocations(a.allocations||[]);this.original_hash=a;this.total=b;this.duration=j;this.offset=l;this.allocations=h;this.renderedAmount=function(){var k=0;h.each(function(o,r){k+=r.rendered.length});return k};this.isEmpty=function(){return b==0}};var PickyView=function(a,b){var j=b.showResultsLimit||10,l=b.alwaysShowResults||false,h=b.input,k=b.reset,o=b.button,r=b.counter,v=b.form,w=b.moreSelector,s=b.results,y=b.noResults,g=new PickyAddination(this,s),d=new PickyAllocationsCloud(this,b),i=new PickyResultsRenderer(g,b),m=function(){k.fadeTo(166,1)},n=function(){d.hide();s.empty();y.hide()},f=function(c){h.val(c);k.fadeTo(166,0);v.attr("class","empty");r.empty();n()};this.reset=f;var p=function(){return h.val()};this.text=p;var q=function(c){r.text(c);
c>0&&c<=5&&r.fadeTo("fast",0.5).fadeTo("fast",1)},e=function(c){if(c.isEmpty())return"none";if(c.total>j&&c.allocations.length>1)return"support";return"ok"};this.insert=function(c){h.val(c);h.select()};this.fullResultsCallback=function(c){var u=e(c);v.attr("class",u);if(c.isEmpty()){n();q(0);y.show();m()}else if(c.total>j&&c.allocations.length>1){n();m();q(c.total);if(l){i.render(s,c);s.show()}d.show(c)}else if(c.offset==0){n();m();q(c.total);i.render(s,c);s.show();h.focus()}else{u=$(w).position().top;
g.remove();i.render(s,c);$("body").animate({scrollTop:u-12},500)}};this.liveResultsCallback=function(c){var u=e(c);v.attr("class",u);q(c.total)};this.allocationChosen=function(c){c=c.data.query;a.insert(c);a.allocationChosen(c)};this.addinationClicked=function(c){a.addinationClicked(p(),c)};(function(){h.keyup(function(c){if(p()==""){f();a.searchTextCleared()}else m();a.searchTextEntered(p(),c)});r.click(function(){a.searchButtonClicked(p())});o.click(function(){a.searchButtonClicked(p())});k.click(function(){f();
a.clearButtonClicked();h.focus()})})();h.focus()};var PickyBackend=function(a){var b=function(j,l,h){var k=h||{};k=$.extend({query:j},h);$.getJSON(a,k,function(o){l&&l(new PickyData(o))})};this.search=function(j,l,h,k){b(j,function(o){l&&l(k,o)},h)}},LiveBackend=function(a){var b=a.live||alert("A live backend path must be provided."),j=new PickyBackend(b);this.search=function(l,h,k,o){o=o||{};latestRequestTimestamp=new Date;o.live=latestRequestTimestamp;k=$.extend({ids:a.liveResults||0,offset:0},k);j.search(l,function(r,v){if(!r.live||r.live==latestRequestTimestamp)h&&
h(v)},k,o)}},FullBackend=function(a){var b=a.full||alert("A full backend path must be provided."),j=new PickyBackend(b);this.search=function(l,h,k,o){o=o||{};latestRequestTimestamp=new Date;o.full=latestRequestTimestamp;k=$.extend({ids:a.fullResults||20,offset:0},k);j.search(l,function(r,v){if(!r.full||r.full==latestRequestTimestamp)h&&h(v)},k,o)}};var PickyController=function(a){var b=new PickyView(this,a),j=a.backends,l=a.beforeInsert||function(){},h=a.before||function(){},k=a.success||function(){},o=a.after||function(){},r=a.searchOnEmpty||false,v=a.liveRendered||false,w=a.liveSearchInterval||180,s,y=function(e){return(e=e&&e.match(/q=([^&]+)/))&&decodeURIComponent(e[1]).replace(/\+/g," ").replace(/#/g,"")||""};this.extractQuery=y;var g=function(){var e=window.History&&window.History.getState();return y(e&&e.url)};this.lastFullQuery=g;var d=
function(e,c,u,x){var z=h(c,x);if(z!=undefined)c=z;s=[e,c,u,x];z=c;if(z!=g()){z=!r&&z==""?"":"?q="+escape(z).replace(/\*/g,"%2A");window.History&&window.History.getState()&&window.History.pushState&&window.History.pushState(null,null,z)}if(!r&&c=="")b.reset();else(e=j[e])&&e.search(c,u,x)};this.resend=function(){s&&d.apply(this,s)};var i=function(e,c){e=k(e,c)||e;b.fullResultsCallback(e);o(e,c)},m=function(e,c){clearInterval(f);d("full",e,i,c||{})};a=function(e,c){e=k(e,c)||e;b.liveResultsCallback(e);
o(e,c)};var n=v?i:a,f,p=function(){var e=b.text();d("live",e,n,{});clearInterval(f)};f=setInterval(p,w);clearInterval(f);var q=function(e,c,u){var x=l(e);if(x!=undefined)e=x;b.insert(e);u&&m(e,c)};this.insert=q;this.clearButtonClicked=function(){clearInterval(f)};this.searchTextCleared=function(){clearInterval(f)};this.searchTextEntered=function(e,c){if($.inArray(c.keyCode,[0,8,13,32,46,48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90])>-1)if(c.keyCode==
13)m(e);else{clearInterval(f);f=setInterval(p,w)}};this.searchButtonClicked=function(e){m(e)};this.allocationChosen=function(e){m(e)};this.addinationClicked=function(e,c){m(e,{offset:c.data.offset})};window.History&&window.History.Adapter.bind(window,"statechange",function(){var e=window.History.getState();e=y(e.url);e!=undefined&&e!=(s&&s.length>1&&s[1])&&q(e,{},true)})};var PickyI18n={},PickyClient=function(a){PickyI18n.locale=$("html").attr("lang").split("-")[0]||"en";a.locale=a.locale||PickyI18n.locale;a.qualifiers=a.qualifiers||{};a.explanations=a.explanations||{};a.choices=a.choices||{};a.explanation_delimiters={ch:"und",de:"und",en:"and",fr:"et",it:"e"};var b=a.backends;if(b){b.live||alert("Both a full and live backend must be provided.");b.full||alert("Both a full and live backend must be provided.")}else a.backends={live:new LiveBackend(a),full:new FullBackend(a)};
b=a.enclosingSelector||".picky";var j=a.formSelector||b+" form";a.form=$(j);a.input=$(a.inputSelector||j+" input[type=search]");a.reset=$(a.resetSelector||j+" div.reset");a.button=$(a.buttonSelector||j+" input[type=button]");a.counter=$(a.counterSelector||j+" div.status");a.results=$(a.resultsSelector||b+" div.results");a.noResults=$(a.noResultsSelector||b+" div.no_results");a.moreSelector=a.moreSelector||b+" div.results div.addination:last";a.allocations=$(a.allocationsSelector||b+" .allocations");
a.shownAllocations=a.allocations.find(".shown");a.showMoreAllocations=a.allocations.find(".more");a.hiddenAllocations=a.allocations.find(".hidden");a.maxSuggestions=a.maxSuggestions||3;a.results=$(a.resultsSelector||b+" div.results");a.resultsDivider=a.resultsDivider||"";a.nonPartial=a.nonPartial||[];a.wrapResults=a.wrapResults||"<ol></ol>";var l=a.controller&&new a.controller(a)||new PickyController(a);var h=this.insert=function(k,o,r){l.insert(k,o||{},r||true)};this.resend=l.resend;this.insertFromURL=
function(k){if(k)h(k);else(k=l.lastFullQuery())&&h(k)}};var PickyAddination=function(a,b){this.remove=function(){b.find(".addination").remove()};this.render=function(j){var l=j.total,h,k=j.renderedAmount();h=j.offset+k;k=h+k;j=j.total;if(j<k)k=j;h={offset:h,start:h+1,end:k};if(h.offset<l){l=$("<div class='addination'>"+t("results.addination.more")+"</div>");l.bind("click",{offset:h.offset},a.addinationClicked);return l}else return""}};var PickyResultsRenderer=function(a,b){var j=b.locale,l=b.explanations||{},h=b.explanation_delimiters||{},k=b.resultsDivider,o=b.wrapResults,r=b.nonPartial,v=function(d){var i=d[d.length-1];if(i===undefined)return[];d=d.slice(0,d.length-1);if(d==[])d=[d];if(!r.include(i[0]))if(i[1].match(/[^\*~]$/))i[1]+="*";d.push(i);return d};this.asteriskifyLastToken=v;var w=function(d){for(var i=l[j]||{},m=[],n,f=0,p=d.length;f<p;f++){n=d[f];var q=n[0];q=i[q]||q;m.push([q,n[1]])}return m};this.explainCategory=
w;var s=function(d,i){return["<strong>"+d+"</strong>",i].join(" ")};this.strongify=s;var y=function(d,i){var m=h[j],n="",f=[],p=[];w(v(i)).each(function(q,e){var c=e[0],u=e[1];u=u.replace(/[\w,]+:(.+)/,"$1");if(n==""||c==n){f.push(u);n=c}else{var x=s(n,f.join(" "));f=[];f.push(u);n=c;p.push(x)}});p.push(s(n,f.join(" ")));p=p.join(" "+m+" ");return p='<span class="explanation">'+d+" "+p+"</span>"};this.explain=y;var g=function(d,i){var m='<div class="header">';m+=y(i.type,i.combination);if(d.offset>
0)m+='<div class="tothetop"><a href="#" onclick="javascript:$(\'body\').animate({scrollTop: 0}, 500);">&uarr;</a></div>';m+="</div>";return m};this.renderHeader=g;this.render=function(d,i){i.allocations.each(function(m,n){if(n.entries.length>0){d.append(g(i,n)).append(n.entries.join(k));d.children("li").wrapAll(o)}});d.append(a.render(i))}};function AllocationRenderer(a){function b(g){var d={},i={},m={},n=[],f,p;f=0;for(p=g.length;f<p;f++){var q=g[f][0];if(q in d){d[q].push(g[f][1]);i[q].push(g[f][2]);n.push(f)}else{d[q]=[g[f][1]];i[q]=[g[f][2]];m[f]=q}}for(f in m){g[f][1]=d[m[f]];g[f][2]=i[m[f]]}for(f=n.length-1;f>=0;f--)g.remove(n[f]);return g}function j(g){g.map(function(d){return"%"+(d+1)+"$s"});return g.join(" ")}function l(g){if(g.length==0)return"";g=b(g);g.sort(function(q,e){return q[0]<e[0]?-1:1});for(var d=[],i=0,m=g.length;i<
m;i++)d.push(g[i][0]);var n=d.length==1,f=s[d.join(",")];if(f===undefined)f=s[d]=j(d);if(typeof f==="string"){s[d]={format:f,ignoreSingle:true};f=s[d]}var p=f.format;g.each(function(q,e){var c=e[0],u=e[1],x=e[2];x.map(function(z,A){var B=u[z];if(B.charAt(B.length-1)=="*")A+="...";return A});f.filter&&x.map(function(z,A){return f.filter(A)});if(n&&!(f&&f.ignoreSingle)){c=v[c]||c;return p=x.join("&nbsp;")+"&nbsp;("+c+")"}x.map(function(z,A){return A.replace(/[\w,]+:(.+)/,"$1")});p=p.replace(RegExp("%"+
(q+1)+"\\$s","g"),x.join("&nbsp;"))});return p}function h(g){for(var d=[],i=0,m=w.length;i<m;i++)d.push([]);d.push([]);i=0;for(m=g.length;i<m;i++){for(var n=g[i],f=n[0],p=false,q=0,e=w.length;q<e;q++)if(w[q].include(f)){d[q].push(n);p=true;break}p||d[d.length-1].push(n)}var c;for(g=d.length-1;g>=0;g--){c=d[g];if(c.length>0)break}c=c[c.length-1];y.include(c[0])||(c[1]=c[1].valueOf()+"*");return d}function k(g){var d=[];h(g).each(function(i,m){var n=l(m);n&&d.push(n)});return d.join(" ")}var o=a.locale,
r=a.qualifiers&&a.qualifiers[o]||{},v=a.explanations&&a.explanations[o]||{},w=a.groups||[],s=a.choices&&a.choices[o]||{},y=a.nonPartial||[];this.explanation=this.query=this.text="";this.contract=b;this.makeUpMissingFormat=j;this.rendered=l;this.groupify=h;this.querify=function(g){var d=[],i,m,n;for(n in g){i=g[n][0];i=r[i]||i;m=(m=g[n][1])||"";m=m.charAt(m.length-1)=="*"?"*":"";d[n]=i+":"+g[n][2]+m}return d.join(" ")};this.suggestify=k;this.render=function(g){return k(g.combination)}};var PickyAllocationsCloud=function(a,b){var j=b.allocations,l=b.shownAllocations,h=b.showMoreAllocations,k=b.hiddenAllocations,o=b.maxSuggestions,r=function(){j.hide()},v=function(g){r();a.allocationChosen(g)},w=new AllocationRenderer(b),s=function(g){var d=[];g.each(function(i,m){var n=w.querify(m.combination),f=w.render(m);f=$('<li><div class="text">'+f+'</div><div class="count">'+m.count+"</div></li>");f.bind("click",{query:n},v);d.push(f)});return d},y=function(g){if(g.length==0)return j.hide();
l.empty();h.hide();k.empty().hide();if(g.length>o){$.each(g.slice(0,o-1),function(d,i){l.append(i)});$.each(g.slice(o-1),function(d,i){k.append(i)});h.show()}else $.each(g,function(d,i){l.append(i)});return j.show()};h.click(function(){h.hide();k.show()});this.hide=r;this.show=function(g){y(s(g.allocations));j.show()}};
