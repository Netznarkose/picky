Array.prototype.index=function(a){for(var b=0,i=this.length;b<i;b++)if(this[b]==a)return b;return null};Array.prototype.include=function(a){return this.index(a)!==null};Array.prototype.remove=function(a){this.splice(a,1);return this};Array.prototype.compare=function(a){return this.join("")==a.join("")};Array.prototype.each=function(a){for(var b=0,i=this.length;b<i;b++)a(b,this[b]);return this};Array.prototype.map=function(a){for(var b=0,i=this.length;b<i;b++)this[b]=a(b,this[b]);return this};var dictionary={common:{join:{de:"und",fr:"et",it:"e",en:"and",ch:"und"},"with":{de:"mit",fr:"avec",it:"con",en:"with",ch:"mit"},of:{de:"von",fr:"de",it:"di",en:"of",ch:"vo"},to:{de:"bis",fr:"\u00e0",it:"alla",en:"to",ch:"bis"}},results:{addination:{more:{de:"Weitere Resultate",fr:"Autres r\u00e9sultats",it:"Altri risultati",en:"More results",ch:"Mee Resultaat"}},header:{de:"Ergebnisse",fr:"R\u00e9sultats",it:"Risultati",en:"Results",ch:"Erg\u00e4bnis"}}},t=function(a){for(var b=PickyI18n.locale||
"en",i=a.split(".").concat(b),k=dictionary,l=0,h=i.length;l<h;l++){k=k[i[l]];if(k==undefined){k="Translation missing: "+a+"."+b;break}}return k};function Allocation(a,b,i,k,l,h){var o=this;this.type=a;this.weight=b;this.count=i;this.combination=k;this.ids=l||[];this.entries=this.rendered=h||[];this.isType=function(r){return r==o.type}}function Allocations(a){this.allocations=[];for(var b=0,i=a.length;b<i;b++){var k=a[b];this.allocations.push(new Allocation(k[0],k[1],k[2],k[3],k[4],k[5]))}this.length=this.allocations.length;this.remove=function(l){this.allocations.splice(l,1)};this.each=function(l){this.allocations.each(l)}}
function PickyData(a){var b=a.total,i=a.duration,k=a.offset,l=new Allocations(a.allocations||[]);this.original_hash=a;this.total=b;this.duration=i;this.offset=k;this.allocations=l;this.renderedAmount=function(){var h=0;l.each(function(o,r){h+=r.rendered.length});return h};this.isEmpty=function(){return b==0}};var PickyView=function(a,b){var i=b.showResultsLimit||10,k=b.alwaysShowResults||false,l=b.alwaysShowSelection||false,h=b.input,o=b.reset,r=b.button,u=b.counter,s=b.form,w=b.moreSelector,x=b.results,g=b.noResults,m=new PickyAddination(this,x),f=new PickyAllocationsCloud(this,b),j=new PickyResultsRenderer(m,b),n=function(c){h.val(c);o.fadeTo(166,0);s.attr("class","empty");u.empty();f.hide();g.hide()};this.reset=n;var d=function(){return h.val()};this.text=d;var q=function(c){if(c.offset==0){x.empty();
j.render(x,c);x.show();h.focus()}else{var v=$(w).position().top;m.remove();j.render(x,c);$("body").animate({scrollTop:v-12},500)}},p=function(c){c>0&&c<=5&&u.fadeTo("fast",0.5).fadeTo("fast",1)},e=function(c){if(c.isEmpty())return"none";if(c.total>i&&c.allocations.length>1)return"support";return"ok"};this.insert=function(c){h.val(c);h.select()};this.fullResultsCallback=function(c){var v=e(c);s.attr("class",v);f.hide();g.hide();o.fadeTo(166,1);v=c.total;u.text(v);p(v);if(c.isEmpty()){x.empty();g.show()}else if(c.total>
i&&c.allocations.length>1){k&&q(c);f.show(c)}else{q(c);l&&f.show(c)}};this.liveResultsCallback=function(c){var v=e(c);s.attr("class",v);c=c.total;u.text(c);p(c)};this.allocationChosen=function(c){c=c.data.query;a.insert(c);a.allocationChosen(c)};this.addinationClicked=function(c){a.addinationClicked(d(),c)};(function(){h.keyup(function(c){if(d()==""){n();a.searchTextCleared()}else o.fadeTo(166,1);a.searchTextEntered(d(),c)});u.click(function(){a.searchButtonClicked(d())});r.click(function(){a.searchButtonClicked(d())});
o.click(function(){n();a.clearButtonClicked();h.focus()})})();h.focus()};var PickyBackend=function(a){var b=function(i,k,l){var h=l||{};h=$.extend({query:i},l);$.getJSON(a,h,function(o){k&&k(new PickyData(o))})};this.search=function(i,k,l,h){b(i,function(o){k&&k(h,o)},l)}},LiveBackend=function(a){var b=a.live||alert("A live backend path must be provided."),i=new PickyBackend(b);this.search=function(k,l,h,o){o=o||{};var r=new Date;o.live=r;h=$.extend({ids:a.liveResults||0,offset:0},h);i.search(k,function(u,s){if(!u.live||u.live==r)l&&l(s,k)},h,o)}},FullBackend=function(a){var b=
a.full||alert("A full backend path must be provided."),i=new PickyBackend(b);this.search=function(k,l,h,o){o=o||{};var r=new Date;o.full=r;h=$.extend({ids:a.fullResults||20,offset:0},h);i.search(k,function(u,s){if(!u.full||u.full==r)l&&l(s,k)},h,o)}};var PickyController=function(a){var b=new PickyView(this,a),i=a.backends,k=a.beforeInsert||function(e){return e},l=a.before||function(e){return e},h=a.success||function(e){return e},o=a.after||function(e){return e},r=a.searchOnEmpty||false,u=a.liveRendered||false,s=a.liveSearchInterval||180,w,x=function(e){return(e=e&&e.match(/q=([^&]+)/))&&decodeURIComponent(e[1]).replace(/\+/g," ").replace(/#/g,"")||""};this.extractQuery=x;var g=function(){var e=window.History&&window.History.getState();return x(e&&
e.url)};this.lastFullQuery=g;var m=function(e,c,v,y){var z=l(c,y);if(z!=undefined)c=z;w=[e,c,v,y];z=c;if(z!=g()){z=!r&&z==""?"":"?q="+escape(z).replace(/\*/g,"%2A");window.History&&window.History.getState()&&window.History.pushState&&window.History.pushState(null,null,z)}if(!r&&c=="")b.reset();else(e=i[e])&&e.search(c,v,y)};this.resend=function(){w&&m.apply(this,w)};var f=function(e,c){(e=h(e,c))&&b.fullResultsCallback(e);o(e,c)},j=function(e,c){clearInterval(d);m("full",e,f,c||{})};a=function(e,
c){(e=h(e,c))&&b.liveResultsCallback(e);o(e,c)};var n=u?f:a,d,q=function(){var e=b.text();m("live",e,n,{});clearInterval(d)};d=setInterval(q,s);clearInterval(d);var p=function(e,c,v){var y=k(e);if(y!=undefined)e=y;b.insert(e);v&&j(e,c)};this.insert=p;this.clearButtonClicked=function(){clearInterval(d)};this.searchTextCleared=function(){clearInterval(d)};this.searchTextEntered=function(e,c){if($.inArray(c.keyCode,[0,8,13,32,46,48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70,71,72,73,74,75,76,77,78,
79,80,81,82,83,84,85,86,87,88,89,90])>-1)if(c.keyCode==13)j(e);else{clearInterval(d);d=setInterval(q,s)}};this.searchButtonClicked=function(e){j(e)};this.allocationChosen=function(e){j(e)};this.addinationClicked=function(e,c){j(e,{offset:c.data.offset})};window.History&&window.History.Adapter.bind(window,"statechange",function(){var e=window.History.getState();e=x(e.url);e!=undefined&&e!=(w&&w.length>1&&w[1])&&p(e,{},true)})};var PickyI18n={},PickyClient=function(a){PickyI18n.locale=$("html").attr("lang").split("-")[0]||"en";a.locale=a.locale||PickyI18n.locale;a.qualifiers=a.qualifiers||{};a.explanations=a.explanations||{};a.choices=a.choices||{};a.explanationDelimiters={ch:"und",de:"und",en:"and",fr:"et",it:"e"};var b=a.backends;if(b){b.live||alert("Both a full and live backend must be provided.");b.full||alert("Both a full and live backend must be provided.")}else a.backends={live:new LiveBackend(a),full:new FullBackend(a)};
b=a.enclosingSelector||".picky";var i=a.formSelector||b+" form";a.form=$(i);a.input=$(a.inputSelector||i+" input[type=search]");a.reset=$(a.resetSelector||i+" div.reset");a.button=$(a.buttonSelector||i+" input[type=button]");a.counter=$(a.counterSelector||i+" div.status");a.results=$(a.resultsSelector||b+" div.results");a.noResults=$(a.noResultsSelector||b+" div.no_results");a.moreSelector=a.moreSelector||b+" div.results div.addination:last";a.allocations=$(a.allocationsSelector||b+" .allocations");
a.shownAllocations=$(a.shownAllocations||a.allocations.find(".shown"));a.showMoreAllocations=$(a.showMoreAllocations||a.allocations.find(".more"));a.hiddenAllocations=$(a.hiddenAllocations||a.allocations.find(".hidden"));a.maxSuggestions=a.maxSuggestions||3;a.results=$(a.resultsSelector||b+" div.results");a.resultsDivider=a.resultsDivider||"";a.nonPartial=a.nonPartial||[];a.wrapResults=a.wrapResults||"<ol></ol>";var k=a.controller&&new a.controller(a)||new PickyController(a);var l=this.insert=function(h,
o,r){k.insert(h,o||{},r||true)};this.resend=k.resend;this.insertFromURL=function(h){if(h)l(h);else(h=k.lastFullQuery())&&l(h)}};var PickyAddination=function(a,b){this.remove=function(){b.find(".addination").remove()};this.render=function(i){var k=i.total,l,h=i.renderedAmount();l=i.offset+h;h=l+h;i=i.total;if(i<h)h=i;l={offset:l,start:l+1,end:h};if(l.offset<k){k=$("<div class='addination'>"+t("results.addination.more")+"</div>");k.bind("click",{offset:l.offset},a.addinationClicked);return k}else return""}};var PickyResultsRenderer=function(a,b){var i=b.locale,k=b.explanations||{},l=b.explanationDelimiters||{},h=b.explanationTokenDelimiter||" ",o=b.resultsDivider,r=b.wrapResults,u=b.nonPartial,s=function(f){var j=f[f.length-1];if(j===undefined)return[];f=f.slice(0,f.length-1);if(f==[])f=[f];if(!u.include(j[0]))if(j[1].match(/[^\*~]$/))j[1]+="*";f.push(j);return f};this.asteriskifyLastToken=s;var w=function(f){for(var j=k[i]||{},n=[],d,q=0,p=f.length;q<p;q++){d=f[q];var e=d[0];e=j[e]||e;n.push([e,d[1]])}return n};
this.explainCategory=w;var x=function(f,j){return["<strong>"+f+"</strong>",j].join(" ")};this.strongify=x;var g=function(f,j){var n=l[i],d="",q=[],p=[];w(s(j)).each(function(e,c){var v=c[0],y=c[1];y=y.replace(/[\w,]+:(.+)/,"$1");if(d==""||v==d){q.push(y);d=v}else{var z=x(d,q.join(h));q=[];q.push(y);d=v;p.push(z)}});p.push(x(d,q.join(h)));p=p.join(" "+n+" ");return p='<span class="explanation">'+f+" "+p+"</span>"};this.explain=g;var m=function(f,j){var n='<div class="header">';n+=g(j.type,j.combination);
if(f.offset>0)n+='<div class="tothetop"><a href="#" onclick="javascript:$(\'body\').animate({scrollTop: 0}, 500);">&uarr;</a></div>';n+="</div>";return n};this.renderHeader=m;this.render=function(f,j){j.allocations.each(function(n,d){if(d.entries.length>0){f.append(m(j,d)).append(d.entries.join(o));f.children("li").wrapAll(r)}});f.append(a.render(j))}};function AllocationRenderer(a){function b(g){var m={},f={},j={},n=[],d,q;d=0;for(q=g.length;d<q;d++){var p=g[d][0];if(p in m){m[p].push(g[d][1]);f[p].push(g[d][2]);n.push(d)}else{m[p]=[g[d][1]];f[p]=[g[d][2]];j[d]=p}}for(d in j){g[d][1]=m[j[d]];g[d][2]=f[j[d]]}for(d=n.length-1;d>=0;d--)g.remove(n[d]);return g}function i(g){g.map(function(m){return"%"+(m+1)+"$s"});return g.join(" ")}function k(g){if(g.length==0)return"";g=b(g);for(var m=[],f=0,j=g.length;f<j;f++)m.push(g[f][0]);var n=m.length==1,d=
w[m.join(",")];if(d===undefined)d=w[m]=i(m);if(typeof d==="string"){w[m]={format:d,ignoreSingle:true};d=w[m]}var q=d.format;g.each(function(p,e){var c=e[0],v=e[1],y=e[2];y.map(function(z,A){var B=v[z];if(B.charAt(B.length-1)=="*")A+="...";return A});d.filter&&y.map(function(z,A){return d.filter(A)});if(n&&!(d&&d.ignoreSingle)){c=u[c]||c;return q=y.join("&nbsp;")+"&nbsp;("+c+")"}y.map(function(z,A){return A.replace(/[\w,]+:(.+)/,"$1")});q=q.replace(RegExp("%"+(p+1)+"\\$s","g"),y.join("&nbsp;"))});
return q}function l(g){for(var m=[],f=0,j=s.length;f<j;f++)m.push([]);m.push([]);f=0;for(j=g.length;f<j;f++){for(var n=g[f],d=n[0],q=false,p=0,e=s.length;p<e;p++)if(s[p].include(d)){m[p].push(n);q=true;break}q||m[m.length-1].push(n)}var c;for(g=m.length-1;g>=0;g--){c=m[g];if(c.length>0)break}c=c[c.length-1];x.include(c[0])||(c[1]=c[1].valueOf()+"*");return m}function h(g){var m=[];l(g).each(function(f,j){var n=k(j);n&&m.push(n)});return m.join(" ")}var o=a.locale,r=a.qualifiers&&a.qualifiers[o]||
{},u=a.explanations&&a.explanations[o]||{},s=a.groups||[],w=a.choices&&a.choices[o]||{},x=a.nonPartial||[];this.explanation=this.query=this.text="";this.contract=b;this.makeUpMissingFormat=i;this.rendered=k;this.groupify=l;this.querify=function(g){var m=[],f,j,n;for(n in g){f=g[n][0];f=r[f]||f;j=(j=g[n][1])||"";j=j.charAt(j.length-1)=="*"?"*":"";m[n]=f+":"+g[n][2]+j}return m.join(" ")};this.suggestify=h;this.render=function(g){return h(g.combination)}};var PickyAllocationsCloud=function(a,b){var i=b.allocations,k=b.shownAllocations,l=b.showMoreAllocations,h=b.hiddenAllocations,o=b.maxSuggestions,r=function(){i.hide()},u=function(g){r();a.allocationChosen(g)},s=new AllocationRenderer(b),w=function(g){var m=[];g.each(function(f,j){var n=s.querify(j.combination),d=s.render(j);d=$('<li><div class="text">'+d+'</div><div class="count">'+j.count+"</div></li>");d.bind("click",{query:n},u);m.push(d)});return m},x=function(g){if(g.length==0)return i.hide();
k.empty();l.hide();h.empty().hide();if(g.length>o){$.each(g.slice(0,o-1),function(m,f){k.append(f)});$.each(g.slice(o-1),function(m,f){h.append(f)});l.show()}else $.each(g,function(m,f){k.append(f)});return i.show()};l.click(function(){l.hide();h.show()});this.hide=r;this.show=function(g){x(w(g.allocations));i.show()}};
